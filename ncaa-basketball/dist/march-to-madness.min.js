"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,n){for(var a=0;a<n.length;a++){var t=n[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,a,t){return a&&e(n.prototype,a),t&&e(n,t),n}}(),Bracketology=function(){function e(n,a){_classCallCheck(this,e),this.data=n,this.ratingsArray=a,this.ratings={},this.nodeBracket=this.buildGames()}return _createClass(e,[{key:"getData",value:function(){return this.data}},{key:"getTeamOrder",value:function(e){if(16==e)return[1,16,8,9,5,12,4,13,6,11,14,3,10,7,15,2];if(8==e)return[1,8,5,4,6,3,7,2];if(4==e)return[1,4,3,2];if(2==e)return[1,2];throw"unable to sort an array of that size"}},{key:"getBracket",value:function(){return this.nodeBracket}},{key:"createNode",value:function(){return{left:null,right:null,winner:null,score:null}}},{key:"placeTeamInNodeArray",value:function(e,n,a){"object"!==("undefined"==typeof n?"undefined":_typeof(n))&&(n.value=n);var t=null;if("left"==a)return null===e[e.length-1].left?(e[e.length-1].left=n,n.ancestor=e[e.length-1],e):(t=this.createNode(),t.left=n,n.ancestor=t,e.push(t),e);for(var r=e.length-1;r>=0;r--)if(null===e[r].right)return e[r].right=n,n.ancestor=e[r],e;return t=this.createNode(),t.right=n,n.ancestor=t,e.push(t),e}},{key:"buildWeeks",value:function(e){var n=e.length;if(n%2==1)return e;for(var a=[this.createNode()],t=0;t<n;t++){var r=t%2===0?"left":"right";a=this.placeTeamInNodeArray(a,e[t],r)}return this.buildWeeks(a)}},{key:"determineWinner",value:function(e,n,a){}},{key:"lookupRating",value:function(e){var n=e.split("/");if(n.length>1){for(var a=0,t=n.length,r=0;r<n.length;r++){var i=n[r].trim(),d=Number(this.lookupRating(i));a+=d}return a/t}if(e=e.replace(/^\d+\.\s*/,"").replace(/ /g,"_"),""===e)return 0;if("undefined"!=typeof this.ratings[e])return this.ratings[e];if("undefined"!=typeof this.ratingsArray)for(var o=0;o<this.ratingsArray.length;o++)if(e==this.ratingsArray[o].team_name)return this.ratingsArray[o].rating;return Math.random().toFixed(4)}},{key:"buildGames",value:function(){var e=this.data.teams,n={};for(var a in e){for(var t=new Array(e[a].length),r=this.getTeamOrder(e[a].length),i=0;i<e[a].length;i++){var d=(i<e[a].length/2?"left":"right",{name:e[a][i],seed:i+1,rating:this.lookupRating(e[a][i])});this.ratings[d.name]=d.rating,this.ratings[d.seed+". "+d.name]=d.rating,this.ratings[d.name.replace(/ /g,"_")]=d.rating,this.ratings[(d.seed+". "+d.name).replace(/ /g,"_")]=d.rating;for(var o=0;o<r.length;o++)if(r[o]==d.seed){t[o]=d;break}}var s=this.buildWeeks(t);n[a]=s}return n}},{key:"printNode",value:function(e,n){var a="";"undefined"!=typeof e.ancestor&&(a=e.ancestor.left==e?"left":"right"),"undefined"!=typeof e.left&&this.printNode(e.left,n-1);for(var t="-----------------";t.length<40*n;)t=" "+t;t.length>0&&console.log(t),"undefined"!=typeof e.right&&this.printNode(e.right,n-1),"undefined"!=typeof e.name&&"undefined"!=typeof e.seed&&console.log(e.seed+". "+e.name)}},{key:"searchNodeDepth",value:function(e){for(var n=0;"undefined"!=typeof e.left;)n+=1,e=e.left;return n}},{key:"printRegion",value:function(e){for(var n=0;n<e.length;n++){var a=e[n],t=this.searchNodeDepth(a);this.printNode(a,t)}}},{key:"getUUID",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0,a="x"==e?n:3&n|8;return a.toString(16)})}},{key:"getFinalFourRegion",value:function(e){for(var n=this.data.finalFour,a=0;a<n.length;a++){for(var t=n[a],r=!1,i="",d=0;d<t.length;d++)i+=t[d],t[d]==e&&(r=!0);if(r)return i}return""}},{key:"findNodeGames",value:function(e,n){"undefined"!=typeof n&&"undefined"!=typeof n.left&&"undefined"!=typeof n.right&&("undefined"==typeof n.gameUUID&&(n.gameUUID=this.getUUID()),"undefined"!=typeof n.left&&"undefined"!=typeof n.right&&(this.findNodeGames(e,n.left),this.findNodeGames(e,n.right)),"undefined"!=typeof n.left.name&&"undefined"!=typeof n.right.name&&e.push(n))}},{key:"findRegionGames",value:function(e){for(var n=[],a=this.nodeBracket[e],t=0;t<e.length;t++){var r=a[t];this.findNodeGames(n,r)}for(t=0;t<n.length;t++)n[t].region=e;return n}},{key:"print",value:function(){for(var e in this.nodeBracket)console.log("Region "+e),console.log("------------------"),this.printRegion(this.nodeBracket[e])}}]),e}();"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=Bracketology:window.Bracketology=Bracketology,function(e){var n=null,a=0,t=-100,r=0,i=function(a,t,r,i,d,o){var s="undefined"==typeof d.gameUUID?"":d.gameUUID,l="undefined"!=typeof a?a:"",p="undefined"!=typeof r.seed?String(r.seed).concat(". "):"",u="undefined"!=typeof i.seed?String(i.seed).concat(". "):"",f="undefined"!=typeof r.name?p+r.name:"&nbsp;",g="undefined"!=typeof i.name?u+i.name:"&nbsp;",h="undefined"!=typeof d.ancestor?d.ancestor.gameUUID:n.getFinalFourRegion(l),m=e("<li>").addClass("spacer").html("&nbsp;");r=e("<li>").addClass("game").addClass("game-top").html(f).addClass("game-"+s).addClass("ancestor-"+h).addClass("region-"+l).prop("title","rating = "+n.lookupRating(f)).data("region",l).data("gameId",s).data("ancestor",h);var c=e("<li>").addClass("game-spacer").html("&nbsp;");"undefined"!=typeof o&&c.addClass(o),i=e("<li>").addClass("game").addClass("game-bottom").html(g).addClass("game-"+s).addClass("ancestor-"+h).addClass("region-"+l).prop("title","rating = "+n.lookupRating(g)).data("region",l).data("gameId",s).data("ancestor",h);var v=e("<li>").addClass("spacer").html("&nbsp;");t.is(":empty")&&t.append(m),t.append(r).append(c).append(i).append(v)},d=function(n){var a=e("li").index(n);return a},o=function(n){var a=e("li.game-"+n);return a},s=function(n){for(var a=n.html(),t=e("li.game-"+n.data("ancestor")),r=!0;r;){r=!1;for(var i=0;i<t.length;i++){var d=e(t[i]);if(d.html()==a){d.removeClass("winner").html("&nbsp"),t=e("li.game-"+d.data("ancestor")),r=!0;break}}}n.html("&nbsp;")},l=function(n,a){for(var t=(o(a),d(n)),r=e("li.ancestor-"+a),i=e("li.game-"+e(n).data("gameId")),l=0,p=0;p<r.length;p++){var u=d(r[p]);u<t&&(l+=1)}i.removeClass("winner"),e(n).addClass("winner");var f=e("li.game-top.game-"+a);l>1&&(f=e("li.game-bottom.game-"+a));var g=f.html(),h=e(n).html();return g!==h&&"&nbsp;"!==g&&s(f),f.html(h),f.prop("title",e(n).prop("title")),f},p=function(n){n.find("li.game");e(n).on("click","li.game",function(){var n=(e(this).data("gameId"),e(this).data("region"),e(this).data("ancestor"));l(this,n)})},u=function(n,a,t){var r=e("<ul>").addClass("round"),d=0,o=[],s=n.data.finalFour,l=0,p=0,u=0,f=0;for(p=0;p<s.length;p++)for(u=0;u<s[p].length;u++)o.push(s[p][u]);for(f=0;f<o.length;f++){var g=o[f];d++,l=n.findRegionGames(g);var h={};for(p=0;p<l.length;p++){var m=l[p];for(u=0;u<t;u++){if("undefined"==typeof m.ancestor)return{gameCount:0,element:r};m=m.ancestor}"undefined"!=typeof m&&(h[m.gameUUID]=m)}var c=0;for(var v in h){var y=h[v],C="undefined"!=typeof y.left?y.left:{name:""},b="undefined"!=typeof y.right?y.right:{name:""},k=c==Object.keys(h).length/2&&0===t?"region-"+g:null;i(g,r,C,b,y,k),c+=1}}var x=d*l.length/Math.pow(2,t);return{gameCount:x,element:r}},f=function(e){if(2==e.length&&r>t){var i={element:e[0]},d={element:e[1]};if(i.element.hasClass("winner"))return i.element;if(d.element.hasClass("winner"))return d.element;i.name=i.element.text(),d.name=d.element.text(),i.rating=n.lookupRating(i.name),d.rating=n.lookupRating(d.name),i.rating=(i.rating+1)/2,d.rating=(d.rating+1)/2,i.p_rating=i.rating*(1-d.rating),d.p_rating=d.rating*(1-i.rating),i.win_odds=i.p_rating/(i.p_rating+d.p_rating),d.win_odds=d.p_rating/(i.p_rating+d.p_rating);var o=r-a,s=i.win_odds>d.win_odds?i:d,l=i.win_odds>d.win_odds?d:i;if(o>=0){var p=1-s.win_odds;s.win_odds=s.win_odds+Math.abs(o)*p/100,l.win_odds=1-s.win_odds}else{var u=s.win_odds-.5;s.win_odds=s.win_odds-Math.abs(o)*u/100,l.win_odds=1-s.win_odds}var f=Math.random();return f>s.win_odds?l.element:s.element}var g=(Math.floor(Math.random()*e.length),e[Math.floor(Math.random()*e.length)]);return g},g=function(){var n=e(".game-TournamentWinner"),a=n.offset().top;e("html, body").animate({scrollTop:a-200},1500)},h=function(n){for(var a=e(n.target),t=a.closest("main"),r=t.find("div.bracket"),i=r.find("ul.round"),d=0;d<i.length;d++){for(var o=i[d],s=e(o).find("li.game"),l={},p=0;p<s.length;p++){var u=e(s[p]).data("gameId");"undefined"==typeof l[u]&&(l[u]=[]),l[u].push(e(s[p]))}for(var h in l){var m=l[h],c=f(m);e(c).trigger("click")}}g()},m=function(n){var a=e(n.target);r=a.prop("value")},c=function(n){var t=e(".ratingsSlider");t.prop("value",a),r=a},v=function(){var n=e("<div>").addClass("instructions").append(e("<p>").addClass("text-right").append(e("<a>").prop("href","//twitter.com/JEinOKC").html("@JEinOKC"))).append(e("<div>").append(e("<h5>").text("Instructions")).append(e("<dl>").append(e("<dt>").text("Use the slider to change the sensitivity of predictions")).append(e("<dd>").text("keep the slider in the middle for the best accuracy. Move it to the right if you hate adventure.")).append(e("<dt>").text("Manually select a game's winner by clicking on their name")).append(e("<dd>").text("Allow your favorite team to skate unskathed all the way into the championship game and just generate everything else."))));return n},y=function a(){e.when(e.get("https://static.jameseng.land/ncaa-basketball/data/ratings-latest.json"),e.get("https://static.jameseng.land/ncaa-basketball/bracketology/data/in/bracket-information-2017.json")).done(function(d,o){var s=o[0],l=d[0];n=new Bracketology(s,l);var f=n.getBracket(),g=e("main");g.empty(),g.append(e("<div>").addClass("row").append(e("<div>").addClass("options-column").addClass("col-xs-12").addClass("col-sm-12").addClass("col-md-6").append(e("<label>").addClass("slider-holder").append(e("<span>").addClass("madness-text").text("madness |").prop("title",'Ratings be damned. Bring on the "madness"')).append(e("<input>").addClass("ratingsSlider").prop("type","range").prop("step",1).prop("min",t).prop("max",t*-1).prop("value",r).change(m)).append(e("<span>").addClass("march-text").text("| march").prop("title",'top rated teams will "March" towards the championship')).append(e("<span>")))).append(e("<div>").addClass("options-column").addClass("col-xs-12").addClass("col-sm-12").addClass("col-md-6").addClass("text-right").append(e("<button>").text("Clear Board").addClass("btn").addClass("btn-danger").addClass("clear-board-btn").click(a)).append(e("<button>").text("Reset Slider").addClass("btn").addClass("btn-default").addClass("reset-slider-btn").click(c)).append(e("<button>").text("Generate Bracket").addClass("btn").addClass("btn-success").addClass("generate-bracket-btn").click(h)))),g.append(e("<div>").addClass("clearfix")),g.append(e("<hr>"));var y=e("<div>").addClass("bracket").append(v());g.append(y);var C=0,b=0;do{var k=u(n,f,b);C=k.gameCount,C>0&&y.append(k.element),b+=1}while(C>=1);for(var x=e("<ul>").addClass("round"),w=n.data.finalFour,_=0;_<w.length;_++)i("finalFour",x,{name:""},{name:""},{gameUUID:n.getFinalFourRegion(w[_][0]),ancestor:{gameUUID:"ChampionshipGame"}});var U=e("<ul>").addClass("round");i("ChampionshipGame",U,{name:""},{name:""},{gameUUID:"ChampionshipGame",ancestor:{gameUUID:"TournamentWinner"}}),y.append(x),y.append(U),p(y);var I=e("<ul>").addClass("champion").addClass("round").append(e("<li>").addClass("game").addClass("game-top").addClass("winner").addClass("game-TournamentWinner").data("gameId","TournamentWinner").html("&nbsp;&nbsp;&nbsp;"));y.append(I)})};y()}(jQuery);