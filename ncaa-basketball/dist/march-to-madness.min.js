"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(a,t,n){return t&&e(a.prototype,t),n&&e(a,n),a}}(),Bracketology=function(){function e(a,t){_classCallCheck(this,e),this.data=a,this.regionsMerged=!1,this.ratingsArray=t,this.ratings={},this.nodeBracket=this.buildGames()}return _createClass(e,[{key:"getData",value:function(){return this.data}},{key:"getTeamOrder",value:function(e){if(16==e)return[1,16,8,9,5,12,4,13,6,11,14,3,10,7,15,2];if(8==e)return[1,8,5,4,6,3,7,2];if(4==e)return[1,4,3,2];if(2==e)return[1,2];throw"unable to sort an array of that size"}},{key:"getBracket",value:function(){return this.nodeBracket}},{key:"createNode",value:function(){return{left:null,right:null,winner:null,score:null}}},{key:"placeTeamInNodeArray",value:function(e,a,t){"object"!==(void 0===a?"undefined":_typeof(a))&&(a.value=a);var n=null;if("left"==t)return null===e[e.length-1].left?(e[e.length-1].left=a,a.ancestor=e[e.length-1],e):(n=this.createNode(),n.left=a,a.ancestor=n,e.push(n),e);for(var r=e.length-1;r>=0;r--)if(null===e[r].right)return e[r].right=a,a.ancestor=e[r],e;return n=this.createNode(),n.right=a,a.ancestor=n,e.push(n),e}},{key:"buildWeeks",value:function(e){var a=e.length;if(a%2==1)return e;for(var t=[this.createNode()],n=0;n<a;n++){var r=n%2==0?"left":"right";t=this.placeTeamInNodeArray(t,e[n],r)}return this.buildWeeks(t)}},{key:"determineWinner",value:function(e,a,t){}},{key:"findGameById",value:function(e){for(var a in this.nodeBracket)for(var t=(this.nodeBracket[a],this.findRegionGames(a)),n=0;n<t.length;n++){var r=t[n];if(e==r.gameUUID)return r;for(;void 0!==r;)if(void 0!==(r=r.ancestor)&&e==r.gameUUID)return r}return null}},{key:"mergeRegions",value:function(){for(var e in this.nodeBracket){this.nodeBracket[e]}if(void 0!==this.data.finalFour){if(this.data.finalFour.length>1){var a=this.createNode();a.gameUUID="ChampionshipGame"}for(var t=0;t<this.data.finalFour.length;t++){var n=this.createNode();n.gameUUID=this.data.finalFour[t][0]+this.data.finalFour[t][1],n.left=this.nodeBracket[this.data.finalFour[t][0]][0],this.nodeBracket[this.data.finalFour[t][0]][0].ancestor=n,n.right=this.nodeBracket[this.data.finalFour[t][1]][0],this.nodeBracket[this.data.finalFour[t][1]][0].ancestor=n,n.ancestor=a;"left"==(t%2==0?"left":"right")?a.left=n:a.right=n}}this.regionsMerged=!0}},{key:"setWinner",value:function(e,a){this.regionsMerged||this.mergeRegions(),a=a.replace(/^\d+\.\s*/,"");var t=this.findGameById(e),n="top";if(null!==t){if(t.left.name==a)t.winner=t.left;else{if(t.right.name!=a)return;t.winner=t.right}var r=null;if(void 0!==t.ancestor){if(t.ancestor.left.gameUUID==e)r=t.ancestor.left;else{if(t.ancestor.right.gameUUID!=e)return;n="bottom",r=t.ancestor.right}return r.name=t.winner.name,r.rating=t.winner.rating,r.seed=t.winner.seed,{direction:n}}if("ChampionshipGame"==t.gameUUID)return{direction:"top"}}}},{key:"lookupRating",value:function(e){var a=e.split("/");if(a.length>1){for(var t=0,n=a.length,r=0;r<a.length;r++){var i=a[r].trim();t+=Number(this.lookupRating(i))}return t/n}if(""===(e=e.replace(/^\d+\.\s*/,"").replace(/ /g,"_")))return 0;if(void 0!==this.ratings[e])return this.ratings[e];if(void 0!==this.ratingsArray)for(var o=0;o<this.ratingsArray.length;o++)if(e==this.ratingsArray[o].team_name)return this.ratingsArray[o].rating;return Math.random().toFixed(4)}},{key:"buildGames",value:function(){var e=this.data.teams,a={};for(var t in e){for(var n=new Array(e[t].length),r=this.getTeamOrder(e[t].length),i=0;i<e[t].length;i++){var o=(e[t].length,{name:e[t][i],seed:i+1,rating:this.lookupRating(e[t][i])});this.ratings[o.name]=o.rating,this.ratings[o.seed+". "+o.name]=o.rating,this.ratings[o.name.replace(/ /g,"_")]=o.rating,this.ratings[(o.seed+". "+o.name).replace(/ /g,"_")]=o.rating;for(var s=0;s<r.length;s++)if(r[s]==o.seed){n[s]=o;break}}var d=this.buildWeeks(n);a[t]=d}return a}},{key:"printNode",value:function(e,a){void 0!==e.ancestor&&e.ancestor.left,void 0!==e.left&&this.printNode(e.left,a-1);for(var t="-----------------";t.length<40*a;)t=" "+t;t.length>0&&console.log(t),void 0!==e.right&&this.printNode(e.right,a-1),void 0!==e.name&&void 0!==e.seed&&console.log(e.seed+". "+e.name)}},{key:"searchNodeDepth",value:function(e){for(var a=0;void 0!==e.left;)a+=1,e=e.left;return a}},{key:"printRegion",value:function(e){for(var a=0;a<e.length;a++){var t=e[a],n=this.searchNodeDepth(t);this.printNode(t,n)}}},{key:"getUUID",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var a=16*Math.random()|0;return("x"==e?a:3&a|8).toString(16)})}},{key:"getFinalFourRegion",value:function(e){for(var a=this.data.finalFour,t=0;t<a.length;t++){for(var n=a[t],r=!1,i="",o=0;o<n.length;o++)i+=n[o],n[o]==e&&(r=!0);if(r)return i}return""}},{key:"findNodeGames",value:function(e,a){void 0!==a&&void 0!==a.left&&void 0!==a.right&&(void 0===a.gameUUID&&(a.gameUUID=this.getUUID()),void 0!==a.left&&void 0!==a.right&&(this.findNodeGames(e,a.left),this.findNodeGames(e,a.right)),void 0!==a.left.name&&void 0!==a.right.name&&e.push(a))}},{key:"findRegionGames",value:function(e){for(var a=[],t=this.nodeBracket[e],n=0;n<e.length;n++){var r=t[n];this.findNodeGames(a,r)}for(n=0;n<a.length;n++)a[n].region=e;return a}},{key:"print",value:function(){for(var e in this.nodeBracket)console.log("Region "+e),console.log("------------------"),this.printRegion(this.nodeBracket[e])}}]),e}();"undefined"!=typeof module&&void 0!==module.exports?module.exports=Bracketology:window.Bracketology=Bracketology,function(e){var a=null,t=0,n=-100,r=0,i=function(t,n,r,i,o,s){var d=void 0===o.gameUUID?"":o.gameUUID,l=void 0!==t?t:"",g=void 0!==r.seed?String(r.seed).concat(". "):"",h=void 0!==i.seed?String(i.seed).concat(". "):"",u=void 0!==r.name?g+r.name:"&nbsp;",p=void 0!==i.name?h+i.name:"&nbsp;",c=void 0!==o.ancestor?o.ancestor.gameUUID:a.getFinalFourRegion(l),m=e("<li>").addClass("spacer").html("&nbsp;");r=e("<li>").addClass("game").addClass("game-top").html(u).addClass("game-"+d).addClass("ancestor-"+c).addClass("region-"+l).prop("title","rating = "+a.lookupRating(u)).data("region",l).data("gameId",d).data("ancestor",c);var f=e("<li>").addClass("game-spacer").html("&nbsp;");void 0!==s&&f.addClass(s),i=e("<li>").addClass("game").addClass("game-bottom").html(p).addClass("game-"+d).addClass("ancestor-"+c).addClass("region-"+l).prop("title","rating = "+a.lookupRating(p)).data("region",l).data("gameId",d).data("ancestor",c);var v=e("<li>").addClass("spacer").html("&nbsp;");n.is(":empty")&&n.append(m),n.append(r).append(f).append(i).append(v)},o=function(a){return e("li").index(a)},s=function(a){return e("li.game-"+a)},d=function(a){for(var t=a.html(),n=e("li.game-"+a.data("ancestor")),r=!0;r;){r=!1;for(var i=0;i<n.length;i++){var o=e(n[i]);if(o.html()==t){o.removeClass("winner").html("&nbsp"),n=e("li.game-"+o.data("ancestor")),r=!0;break}}}a.html("&nbsp;")},l=function(t,n){var r=e(t),i=(s(n),o(t)),l=e("li.ancestor-"+n),g=e("li.game-"+r.data("gameId")),h=a.setWinner(r.data("gameId"),r.text());if(void 0!==h){for(var u=0,p=0;p<l.length;p++){o(l[p])<i&&(u+=1)}g.removeClass("winner"),e(".game-TournamentWinner").addClass("winner"),e(t).addClass("winner");var c=e("li.game-"+h.direction+".game-"+n),m=c.html(),f=r.html();return m!==f&&"&nbsp;"!==m&&d(c),c.html(f),c.prop("title",r.prop("title")),c}},g=function(a){a.find("li.game");e(a).on("click","li.game",function(){var a=(e(this).data("gameId"),e(this).data("region"),e(this).data("ancestor"));l(this,a)})},h=function(a,t,n){var r=e("<ul>").addClass("round"),o=0,s=[],d=a.data.finalFour,l=0,g=0,h=0,u=0;for(g=0;g<d.length;g++)for(h=0;h<d[g].length;h++)s.push(d[g][h]);for(u=0;u<s.length;u++){var p=s[u];o++,l=a.findRegionGames(p);var c={};for(g=0;g<l.length;g++){var m=l[g];for(h=0;h<n;h++){if(void 0===m.ancestor)return{gameCount:0,element:r};m=m.ancestor}void 0!==m&&(c[m.gameUUID]=m)}var f=0;for(var v in c){var C=c[v],k=void 0!==C.left?C.left:{name:""},y=void 0!==C.right?C.right:{name:""},b=f==Object.keys(c).length/2&&0===n?"region-"+p:null;i(p,r,k,y,C,b),f+=1}}return{gameCount:o*l.length/Math.pow(2,n),element:r}},u=function(e){if(2==e.length&&r>n){var i={element:e[0]},o={element:e[1]};if(i.element.hasClass("winner"))return i.element;if(o.element.hasClass("winner"))return o.element;i.name=i.element.text(),o.name=o.element.text(),i.rating=a.lookupRating(i.name),o.rating=a.lookupRating(o.name),i.rating=(i.rating+1)/2,o.rating=(o.rating+1)/2,i.p_rating=i.rating*(1-o.rating),o.p_rating=o.rating*(1-i.rating),i.win_odds=i.p_rating/(i.p_rating+o.p_rating),o.win_odds=o.p_rating/(i.p_rating+o.p_rating);var s=r-t,d=i.win_odds>o.win_odds?i:o,l=i.win_odds>o.win_odds?o:i;if(s>=0){var g=1-d.win_odds;d.win_odds=d.win_odds+Math.abs(s)*g/100,l.win_odds=1-d.win_odds}else{var h=d.win_odds-.5;d.win_odds=d.win_odds-Math.abs(s)*h/100,l.win_odds=1-d.win_odds}return Math.random()>d.win_odds?l.element:d.element}Math.floor(Math.random()*e.length);return e[Math.floor(Math.random()*e.length)]},p=function(){var a=e(".game-TournamentWinner"),t=a.offset().top;e("html, body").animate({scrollTop:t-200},1500)},c=function(a){for(var t=e(a.target),n=t.closest("main"),r=n.find("div.bracket"),i=r.find("ul.round"),o=0;o<i.length;o++){for(var s=i[o],d=e(s).find("li.game"),l={},g=0;g<d.length;g++){var h=e(d[g]).data("gameId");void 0===l[h]&&(l[h]=[]),l[h].push(e(d[g]))}for(var c in l){var m=l[c],f=u(m);e(f).trigger("click")}}p()},m=function(a){var t=e(a.target);r=t.prop("value")},f=function(a){e(".ratingsSlider").prop("value",t),r=t},v=function(){return e("<div>").addClass("instructions").append(e("<p>").addClass("text-right").append(e("<a>").prop("href","//twitter.com/JEinOKC").html("@JEinOKC"))).append(e("<div>").append(e("<h5>").text("Instructions")).append(e("<dl>").append(e("<dt>").text("Use the slider to change the sensitivity of predictions")).append(e("<dd>").text("keep the slider in the middle for the best accuracy. Move it to the right if you hate adventure.")).append(e("<dt>").text("Manually select a game's winner by clicking on their name")).append(e("<dd>").text("Allow your favorite team to skate unskathed all the way into the championship game and just generate everything else."))))};!function t(){e.when(e.get("https://static.jameseng.land/ncaa-basketball/data/ratings-latest.json"),e.get("https://static.jameseng.land/ncaa-basketball/bracketology/data/in/bracket-information-2018.json")).done(function(o,s){var d=s[0],l=o[0];a=new Bracketology(d,l);var u=a.getBracket(),p=e("main");p.empty(),p.append(e("<div>").addClass("row").append(e("<div>").addClass("options-column").addClass("col-xs-12").addClass("col-sm-12").addClass("col-md-6").append(e("<label>").addClass("slider-holder").append(e("<span>").addClass("madness-text").text("madness |").prop("title",'Ratings be damned. Bring on the "madness"')).append(e("<input>").addClass("ratingsSlider").prop("type","range").prop("step",1).prop("min",n).prop("max",-1*n).prop("value",r).change(m)).append(e("<span>").addClass("march-text").text("| march").prop("title",'top rated teams will "March" towards the championship')).append(e("<span>")))).append(e("<div>").addClass("options-column").addClass("col-xs-12").addClass("col-sm-12").addClass("col-md-6").addClass("text-right").append(e("<button>").text("Clear Board").addClass("btn").addClass("btn-danger").addClass("clear-board-btn").click(t)).append(e("<button>").text("Reset Slider").addClass("btn").addClass("btn-default").addClass("reset-slider-btn").click(f)).append(e("<button>").text("Generate Bracket").addClass("btn").addClass("btn-success").addClass("generate-bracket-btn").click(c)))),p.append(e("<div>").addClass("clearfix")),p.append(e("<hr>"));var C=e("<div>").addClass("bracket").append(v());p.append(C);var k=0,y=0;do{var b=h(a,u,y);k=b.gameCount,k>0&&C.append(b.element),y+=1}while(k>=1);for(var x=e("<ul>").addClass("round"),w=a.data.finalFour,U=0;U<w.length;U++)i("finalFour",x,{name:""},{name:""},{gameUUID:a.getFinalFourRegion(w[U][0]),ancestor:{gameUUID:"ChampionshipGame"}});var _=e("<ul>").addClass("round");i("ChampionshipGame",_,{name:""},{name:""},{gameUUID:"ChampionshipGame",ancestor:{gameUUID:"TournamentWinner"}}),C.append(x),C.append(_),g(C);var I=e("<ul>").addClass("champion").addClass("round").append(e("<li>").addClass("game").addClass("game-top").addClass("winner").addClass("game-TournamentWinner").data("gameId","TournamentWinner").html("&nbsp;&nbsp;&nbsp;"));C.append(I)})}()}(jQuery);